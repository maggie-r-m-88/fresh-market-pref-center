<!doctype html>
%%[
SET @servicePageID = 646

/*
SET @GetProfileAddr = CloudPagesURL(@servicePageID,"action","get")
SET @UpdateProfileAddr = CloudPagesURL(@servicePageID,"action","update")
SET @GetStoresAddr = CloudPagesURL(@servicePageID,"action","liststores")
*/

SET @GetProfileAddr = Replace(CloudPagesURL(@servicePageID,"action","get"),'http://','https://')
SET @UpdateProfileAddr = Replace(CloudPagesURL(@servicePageID,"action","update"),'http://','https://')
SET @GetStoresAddr = Replace(CloudPagesURL(@servicePageID,"action","liststores"),'http://','https://')

]%%
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>TFM PREFERENCE CENTER</title>
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link href="https://pub.s10.exacttarget.com/icuk3ar3smf" rel="stylesheet" type="text/css" />
        <link href="https://pub.s10.exacttarget.com/2wmh1h1ahgv" rel="stylesheet" type="text/css" />
        <style type="text/css">
            [v-cloak] {display:none;}
            button:not([disabled]):hover {cursor:pointer;}
            button:disabled{background-color:#aaa; color: white;}
            .invalid {background-color: pink; border-color: red;}
            .invalid:focus {box-shadow:0px 0px 3px 3px #f00;}
        </style>
        <script language="javascript">
            /*try {
                if(window.location.href.substr(0,5) !== 'https'){
                  window.location.href = window.location.href.replace('http', 'https');
                } 
             } 
             catch(e) {} */
        </script>
    </head>
    
    <body>
    <div class="container bg-green">
        
        <div class="row">
            <div class="col-12 padB30" align="center">&nbsp;</div>
        </div>
        
    </div>    
    <div class="container">
        <br>
        <div align="center" class=""><img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/c920a979-002d-478f-911e-3c874afbf67c.png" width="100"></div>
    </div>
    <div id="app" v-cloak>
        <div id="formPanel">
            <div class="container">
                <br>
                <div class="title01">MANAGE YOUR PREFERENCES</div>
                
                <div class="body01 lg-padL100 lg-padR100">We love, love, love delicious food and we want to share all the exciting news about what's in store with you! Let us know more about the foods you love and the information you want so we can send you the most relevant, timely and inspiring ideas and offers.</div>
            </div>
                
            <div class="container bg-gray">
                
                <div class="row">
                    <div class="title02 col-12 padB20 padT30">Update My Information</div>
                </div>
                
                <div class="row">
                    <div class="col-xs-12 col-md-6">
                        <label for="EmailAddress">CURRENT EMAIL ADDRESS</label>
                        <input type="test" v-model="form.EmailAddress" class="form-control" id="EmailAddress" aria-describedby="emailHelp" placeholder="Enter Email" readonly novalidate>
                    </div>
                    <div class="col-xs-12 col-md-6 xs-padT10 sm-padT10 md-padT0">
                        <label for="New_EmailAddress">CHANGE MY EMAIL ADDRESS TO</label>
                        <input type="text" v-model="form.New_EmailAddress" class="form-control" v-bind:class="{ 'invalid': !IsValid_New_EmailAddress }" id="New_EmailAddress" aria-describedby="emailHelp" placeholder="Enter New Email Address" >
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xs-12 col-md-6 padT10">
                        <label for="usr">FIRST NAME</label>
                        <input type="text" class="form-control" id="firstName" v-model="form.First_Name" placeholder="Enter First Name">
                    </div>
                    <div class="col-xs-12 col-md-6 padT10">
                        <label for="usr">LAST NAME</label>
                        <input type="text" class="form-control" id="lastName" v-model="form.Last_Name" placeholder="Enter Last Name">
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xs-12 col-md-6 padT10">
                        <label for="usr">YOUR STORE'S STATE</label>
                        <div class="form-group">
                            <select class="form-control form-green" id="state" name="state" v-model="store_state"  @change="filterDropDownByState()">
                                <option v-for="option in this.availableStoreStates" v-bind:value="option.code">{{ option.name }}</option>
<!--
                                <option value="">Select A State</option>
                                <option value="AK">Alaska</option>
                                <option value="AL">Alabama</option>
                                <option value="AR">Arkansas</option>
                                <option value="AZ">Arizona</option>
                                <option value="CA">California</option>
                                <option value="CO">Colorado</option>
                                <option value="CT">Connecticut</option>
                                <option value="DC">District of Columbia</option>
                                <option value="DE">Delaware</option>
                                <option value="FL">Florida</option>
                                <option value="GA">Georgia</option>
                                <option value="HI">Hawaii</option>
                                <option value="IA">Iowa</option>
                                <option value="ID">Idaho</option>
                                <option value="IL">Illinois</option>
                                <option value="IN">Indiana</option>
                                <option value="KS">Kansas</option>
                                <option value="KY">Kentucky</option>
                                <option value="LA">Louisiana</option>
                                <option value="MA">Massachusetts</option>
                                <option value="MD">Maryland</option>
                                <option value="ME">Maine</option>
                                <option value="MI">Michigan</option>
                                <option value="MN">Minnesota</option>
                                <option value="MO">Missouri</option>
                                <option value="MS">Mississippi</option>
                                <option value="MT">Montana</option>
                                <option value="NC">North Carolina</option>
                                <option value="ND">North Dakota</option>
                                <option value="NE">Nebraska</option>
                                <option value="NH">New Hampshire</option>
                                <option value="NJ">New Jersey</option>
                                <option value="NM">New Mexico</option>
                                <option value="NV">Nevada</option>
                                <option value="NY">New York</option>
                                <option value="OH">Ohio</option>
                                <option value="OK">Oklahoma</option>
                                <option value="OR">Oregon</option>
                                <option value="PA">Pennsylvania</option>
                                <option value="PR">Puerto Rico</option>
                                <option value="RI">Rhode Island</option>
                                <option value="SC">South Carolina</option>
                                <option value="SD">South Dakota</option>
                                <option value="TN">Tennessee</option>
                                <option value="TX">Texas</option>
                                <option value="UT">Utah</option>
                                <option value="VA">Virginia</option>
                                <option value="VT">Vermont</option>
                                <option value="WA">Washington</option>
                                <option value="WI">Wisconsin</option>
                                <option value="WV">West Virginia</option>
                                <option value="WY">Wyoming</option>
-->
                            </select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6 md-padT10">
                        <label for="usr">YOUR STORE LOCATION</label>
                       <div class="form-group">
                            <select v-model="form.store_group" class="form-control form-green" id="storeLocation">
                               <!--<option value="">Select A Store</option>-->
                               <option v-for="option in filteredStoreList" v-bind:value="option.Store">{{ option.Name }}</option>
                            </select>
                     </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-xs-12 col-md-6 xs-padT10 sm-padT10 md-padT0">
                        <label for="usr">BIRTHDAY MONTH</label>
                        <div class="form-group">
                            <select class="form-control form-green" id="birthdayMonth" name="birthday-month" v-model="form.BirthMonth">
                                <option value="">Select A Month</option>
                                <option value="January">January</option>
                                <option value="February">February</option>
                                <option value="March">March</option>
                                <option value="April">April</option>
                                <option value="May">May</option>
                                <option value="June">June</option>
                                <option value="July">July</option>
                                <option value="August">August</option>
                                <option value="September">September</option>
                                <option value="October">October</option>
                                <option value="November">November</option>
                                <option value="December">December</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-6">
                        <label for="usr">YOUR ZIP CODE</label>
                        <input type="text" class="form-control" id="ZipCode" v-model="form.ZipCode" placeholder="Enter Zip Code" v-bind:class="{ 'invalid': !IsValid_ZipCode }" >
                  </div>
                </div>
                
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB20 sm-padB20" align="center">
                        <button class="btn-green" role="button" @click="submit(true)">Update My Information</button>
                    </div>
                </div>
                
                <hr>
              
                <!-- BEGIN INTEREST PANEL -->
                <div id="interestpanel" style="display:none">
                  
                <div class="row">
                    <div class="title02 col-12 padB20 padT10">Update My Preferences</div>
                </div>
                
                <div class="row">
                    <div class="body01 col-12 padT0 padB20">Which type of content and food are you most interested in? (Select all that apply)</div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="allTopics" @click="checkAll(true)">
                        <label class="checkbox-text" for="allTopics">Interested in All Topics</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox2" v-model="form.i_Store_Events" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox2">Store Events</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox3" v-model="form.i_Vegetarian_Foods" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox3">Vegetarian Foods</label>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox4" v-model="form.i_Weekly_Specials_and_Sales" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox4">Weekly Specials & Sales</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox5" v-model="form.i_New_Items" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox5">New Items</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox6" v-model="form.i_Gluten_Free_Foods" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox6">Gluten Free Foods</label>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox7" v-model="form.i_Recipes_and_Tips" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox7">Recipes & Tips</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox8" v-model="form.i_Local_Products" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox8">Local Products</label>
                    </div>
                    <div class="col-md-4">
                        <input class="big-checkbox marT3 marR5" type="checkbox" id="inlineCheckbox9" v-model="form.i_Kosher_Foods" true-value="true" false-value="false" @click="checkAll(false)">
                        <label class="checkbox-text" for="inlineCheckbox9">Kosher Foods</label>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB20 sm-padB20" align="center">
                        <button class="btn-green" role="button" @click="submit(true)">Update My Preferences</button>
                    </div>
                </div>
                
                <hr>
                </div>
              <!-- END INTEREST PANEL -->
              
                <div class="row" id="unsub">
                    <div class="title02 col-12 padB20 padT10">Need a Break?</div>
                </div>
                
                <div class="row">
                    <div class="body01 col-12 padT0 padB20">If you’d like to unsubscribe or reduce the number of emails you receive from The Fresh Market, please update your status.*</div>
                </div>
                
                <div class="row">
                    <table border="0" cellspacing="0" cellpadding="0" align="center">
                        <tr>
                            <td class="no-wrap">
                                <div class="col-12">
                                    <input class="big-checkbox marT3 marR5" type="radio" id="radioUnchecked01" v-model="form.PreferenceStatus" value="throttle_down" name="groupOfStatusRadios">
                                    <label class="checkbox-text" for="radioUnchecked01">I would like to receive <span style="font-weight: bold;">FEWER EMAILS</span> from The Fresh Market.</label>
                                </div>
                                <div class="col-12">
                                    <input class="big-checkbox marT3 marR5" type="radio" id="radioUnchecked02" v-model="form.PreferenceStatus" value="unsubscribed" name="groupOfStatusRadios">
                                    <label class="checkbox-text" for="radioUnchecked02">Please <span style="font-weight: bold;">UNSUBSCRIBE</span> me from ALL marketing emails from The Fresh Market.</label>
                                </div>
                                <div class="col-12">
                                    <input class="big-checkbox marT3 marR5" type="radio" id="radioUnchecked03" v-model="form.PreferenceStatus" value="subscribe" name="groupOfStatusRadios">
                                    <label class="checkbox-text" for="radioUnchecked03">I would like to <span style="font-weight: bold;">CONTINUE</span> receiving The Fresh Market communications.</label>
                                </div>
                            </td>
                        </tr>
                    </table>
                </div>
                
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB20 sm-padB20" align="center">
                        <button class="btn-green" role="button" @click="submit(true)" :disabled="Org_PreferenceStatus == form.PreferenceStatus">Update My Status</button>
                    </div>
                </div>
                
                <div class="row">
                    <div class="disclaimer01 col-12 padT0 padB20" align="center">*Note that it may take up to one week for your subscription changes to take effect. </div>
                </div>
                
                <div class="row">
                    <div class="col-12 padB40" align="center">&nbsp;</div>
                </div>
                
            </div>
        </div><!-- formpanel -->
        <div id="confirmPanel" style="display:none">
            <div class="container">
                <br />
                <div class="title01">THANKS FOR THE UPDATE</div>
                <div class="body02 lg-padL100 lg-padR100">Your email preferences have been saved. We are proud to provide tasty, fresh fare and effortlessly delicious meals every day. We hope you'll find the inspiration to make everyday eating extraordinary.</div>
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB20 sm-padB20" align="center">
                        <a class="btn-green" href="https://www.thefreshmarket.com/" role="button">Get Inspired</a>
                    </div>
                </div>
                <div class="body02 lg-padL100 lg-padR100">
                    Not finished updating your preferences yet?
                    <br />Click the button below to go back and continue updating your information.
                </div>
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB20 sm-padB20" align="center">
                        <button class="btn-green" role="button" onclick="window.location.reload(false)">Update My Preferences</button>
                    </div>
                </div>
                <br />
                <div class="title03 col-12 padB30 padT40">
                <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/41fe1441-0052-4d17-bc76-61d88e1f3895.png" class="hide" alt="" width="183" />Let's Stay Connected
                <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/8060d10f-5bde-4120-8349-0940c0ea5a0c.png" class="hide" alt="" width="183" /></div>
                <div class="row">
                    <div class="align-center">
                        <a href="https://www.facebook.com/TheFreshMarket" alias="IMG/Facebook Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/400f31a9-2340-4619-9bd7-65d4b9a50af8.png" alt="Join our community on Facebook" width="65" />
                        </a>
                        <a href="https://twitter.com/TheFreshMarket" alias="IMG/Twitter Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/7f2843c6-2fac-41e5-a116-4150637adbe2.png" alt="Join our community on Twitter" width="65" />
                        </a>
                        <a href="https://www.pinterest.com/thefreshmarket/" alias="IMG/Pinterest Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/429431d8-ab6c-4a55-ac24-56ab6a228d32.png" alt="Join our community on Pinterest" width="65" />
                        </a>
                        <a href="https://www.youtube.com/user/TheFreshMarketInc" alias="IMG/YouTube Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/c69560cc-0403-485d-8ec9-ec471bb15729.png" alt="Join our community on YouTube" width="65" />
                        </a>
                        <a href="https://www.instagram.com/thefreshmarket/" alias="IMG/Instagram Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/394ec0d0-c920-431e-8c0b-3113f94fd1bd.png" alt="Join our community on Instagram" width="65" />
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 padB40" align="center"></div>
                </div>
            </div>
        </div><!-- confirm panel -->
        <div id="unsubSurveyPanel" style="display:none">
            <div class="container">
                <br />
                <div class="title01">WE'RE SORRY TO SEE YOU GO</div>
                <div class="body02 lg-padL60 lg-padR60">You've been successfully unsubscribed from our email list. If this was made in error, you may re-subscribe by clicking the button below.</div>
                <div class="row">
                    <div class="col-12 xs-padB40 sm-padB40" align="center">
                        <button class="btn-green" role="button" onclick="window.location.reload(true)">Re-Subscribe</button>
                    </div>
                </div>
            </div>
            <div class="container bg-gray">
                <div class="row">
                    <div class="title03 col-12 padB30 padT60">
                    <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/41fe1441-0052-4d17-bc76-61d88e1f3895.png" class="hide" alt="" width="183" />Before You Go
                    <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/8060d10f-5bde-4120-8349-0940c0ea5a0c.png" class="hide" alt="" width="183" /></div>
                </div>
                <div class="row">
                    <div class="body01 col-12 padT0 padB20 align-center">Please share your reasons for unsubscribing - we appreciate your feedback!</div>
                </div>
                <div class="row">
                    <table border="0" cellspacing="0" cellpadding="0" align="center">
                        <tr>
                            <td class="no-wrap">
                                <div class="col-12">
                                <input class="big-checkbox marT3 marR5" type="checkbox" id="UnsubReason1" v-model="UnsubReason1" true-value="I no longer wish to receive these emails." false-value=""/> 
                                <label class="checkbox-text" for="UnsubReason1">I no longer wish to receive these emails.</label></div>
                                <div class="col-12">
                                <input class="big-checkbox marT3 marR5" type="checkbox" id="UnsubReason2" v-model="UnsubReason2" true-value="I'm receiving too many emails from The Fresh Market." false-value=""/>  
                                <label class="checkbox-text" for="UnsubReason2">I'm receiving too many emails from The Fresh Market.</label></div>
                                <div class="col-12">
                                <input class="big-checkbox marT3 marR5" type="checkbox" id="UnsubReason3" v-model="UnsubReason3" true-value="The content is no longer relevant to me." false-value=""/> 
                                <label class="checkbox-text" for="UnsubReason3">The content is no longer relevant to me.</label></div>
                                <div class="col-12">
                                <input class="big-checkbox marT3 marR5" type="checkbox" id="UnsubReason4" v-model="UnsubReason4" true-value="I never signed up for this mailing list." false-value=""/>  
                                <label class="checkbox-text" for="UnsubReason4">I never signed up for this mailing list.</label></div>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="row">
                    <div class="col-12 xs-padT20 sm-padT20 xs-padB60 sm-padB60" align="center">
                        <button class="btn-green" role="button" @click="SubmitUnsubReason()">Send Feedback</button>
                    </div>
                </div>
            </div>
            <div class="container">
                <div class="title03 col-12 padB30 padT40">
                <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/41fe1441-0052-4d17-bc76-61d88e1f3895.png" class="hide" alt="" width="183" />Let's Stay Connected
                <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/8060d10f-5bde-4120-8349-0940c0ea5a0c.png" class="hide" alt="" width="183" /></div>
                <div class="row">
                    <div class="align-center">
                        <a href="https://www.facebook.com/TheFreshMarket" alias="IMG/Facebook Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/400f31a9-2340-4619-9bd7-65d4b9a50af8.png" alt="Join our community on Facebook" width="65" />
                        </a>
                        <a href="https://twitter.com/TheFreshMarket" alias="IMG/Twitter Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/7f2843c6-2fac-41e5-a116-4150637adbe2.png" alt="Join our community on Twitter" width="65" />
                        </a>
                        <a href="https://www.pinterest.com/thefreshmarket/" alias="IMG/Pinterest Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/429431d8-ab6c-4a55-ac24-56ab6a228d32.png" alt="Join our community on Pinterest" width="65" />
                        </a>
                        <a href="https://www.youtube.com/user/TheFreshMarketInc" alias="IMG/YouTube Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/c69560cc-0403-485d-8ec9-ec471bb15729.png" alt="Join our community on YouTube" width="65" />
                        </a>
                        <a href="https://www.instagram.com/thefreshmarket/" alias="IMG/Instagram Icon" target="_blank">
                            <img src="https://image.thefreshmarketmail.com/lib/fe38157075640579711178/m/1/394ec0d0-c920-431e-8c0b-3113f94fd1bd.png" alt="Join our community on Instagram" width="65" />
                        </a>
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 padB40" align="center"></div>
                </div>
            </div>
        </div><!-- unsubSurveyPanel panel -->
        <div id="errorPanel" style="display:none">
            <div class="container">
                <br />
                <div class="title01">Oops, something went wrong!</div>
                <div class="body02 lg-padL60 lg-padR60">I'm sorry, but there was an error processing your request.</div>
            </div>
        </div><!-- errorPanel panel -->
    </div>
      
      
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://pub.s10.exacttarget.com/qlox4b54r1s" language="javascript"></script>
    <script src="https://pub.s10.exacttarget.com/inzwepzod4c" language="javascript"></script>
 
    <script type="text/javascript">
    var getURL = "%%=v(@GetProfileAddr)=%%";
    var updateURL = "%%=v(@UpdateProfileAddr)=%%";
    var getStoreURL = "%%=v(@GetStoresAddr)=%%";
    var stateCodes = [{ code:"AK", name:"Alaska" },{ code:"AL", name:"Alabama" },{ code:"AR", name:"Arkansas" },{ code:"AZ", name:"Arizona" },{ code:"CA", name:"California" },{ code:"CO", name:"Colorado" },{ code:"CT", name:"Connecticut" },{ code:"DC", name:"District of Columbia" },{ code:"DE", name:"Delaware" },{ code:"FL", name:"Florida" },{ code:"GA", name:"Georgia" },{ code:"HI", name:"Hawaii" },{ code:"IA", name:"Iowa" },{ code:"ID", name:"Idaho" },{ code:"IL", name:"Illinois" },{ code:"IN", name:"Indiana" },{ code:"KS", name:"Kansas" },{ code:"KY", name:"Kentucky" },{ code:"LA", name:"Louisiana" },{ code:"MA", name:"Massachusetts" },{ code:"MD", name:"Maryland" },{ code:"ME", name:"Maine" },{ code:"MI", name:"Michigan" },{ code:"MN", name:"Minnesota" },{ code:"MO", name:"Missouri" },{ code:"MS", name:"Mississippi" },{ code:"MT", name:"Montana" },{ code:"NC", name:"North Carolina" },{ code:"ND", name:"North Dakota" },{ code:"NE", name:"Nebraska" },{ code:"NH", name:"New Hampshire" },{ code:"NJ", name:"New Jersey" },{ code:"NM", name:"New Mexico" },{ code:"NV", name:"Nevada" },{ code:"NY", name:"New York" },{ code:"OH", name:"Ohio" },{ code:"OK", name:"Oklahoma" },{ code:"OR", name:"Oregon" },{ code:"PA", name:"Pennsylvania" },{ code:"PR", name:"Puerto Rico" },{ code:"RI", name:"Rhode Island" },{ code:"SC", name:"South Carolina" },{ code:"SD", name:"South Dakota" },{ code:"TN", name:"Tennessee" },{ code:"TX", name:"Texas" },{ code:"UT", name:"Utah" },{ code:"VA", name:"Virginia" },{ code:"VT", name:"Vermont" },{ code:"WA", name:"Washington" },{ code:"WI", name:"Wisconsin" },{ code:"WV", name:"West Virginia" },{ code:"WY", name:"Wyoming"}];

    var ScrollTo = function(id) {
        window.scrollTo(0,$("#"+id).offset().top - 100);
    };
      
    jQuery( document ).ready(function( $ ) {
        $(window).on('popstate', function() {
           location.reload(true);
        });
    });
      
    var app = new Vue({
        el: '#app',
        data: {
            filteredStoreList: [],
            availableStoreStates: [{code:"", name:"Select A State"}],
            store_state: "",
            store_groups: [],
            Org_PreferenceStatus: "",
            UnsubReason1: "",
            UnsubReason2: "",
            UnsubReason3: "",
            UnsubReason4: "",
            form: {
                EmailAddress: "",
                New_EmailAddress: "",
                SubscriberStatus: "",
                First_Name: "",
                Last_Name: "",
                store_group: "",
                ZipCode: "",
                BirthMonth: "",
                i_Weekly_Specials_and_Sales: "false",
                i_Recipes_and_Tips: "false",
                i_Store_Events: "false",
                i_New_Items: "false",
                i_Local_Products: "false",
                i_Vegetarian_Foods: "false",
                i_Gluten_Free_Foods: "false",
                i_Kosher_Foods: "false",
                unsubscribe_reason: "",
                PreferenceStatus: "",
                Submitted: false,
                Error: false
            },
            valids: {}
        },
        computed: {
            UpdateMessage: function () {
                return "";
            },
            IsValid_ZipCode: function() {
                var str = this.form.ZipCode.trim();
                if(str.length > 0 && !/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(str))
                    return false;
                return true;
         },
            IsValid_New_EmailAddress: function() {
                var str = this.form.New_EmailAddress.trim();
                if(str.length > 0 && ( str.length > 255 || str.indexOf("@") == -1 || str.indexOf("@", str.length - 1) !== -1 || str.indexOf(".", str.length - 1) !== -1 || str.lastIndexOf(".") < str.lastIndexOf("@") || str.lastIndexOf("@") != str.indexOf("@") || str.lastIndexOf("..") > str.lastIndexOf("@"))) {
                    return false;
                }
                return true;
            }
        },
        mounted: function () {
            console.log('Page mounted');
            axios.get(getURL)
             .then( function (response) {
                    if (!response || response.data.requestStatus == "ERROR") {
                        this.form.Error = true;
                        console.log('Error getting subscriber.');
                        ShowPanel(99);
                    } else {
                        if( response.data.data.EmailAddress == response.data.data.New_EmailAddress)
                            response.data.data.New_EmailAddress = "";
                        if(!this.Org_PreferenceStatus)/*original status used to check if value changed to unsubscribed*/
                            this.Org_PreferenceStatus = response.data.data.PreferenceStatus;
                        this.form = response.data.data;
                      
                        axios.get(getStoreURL).then(
                            function (response) {
                                if (!response || response.data.requestStatus == "ERROR") {
                                    this.form.Error = true;
                                    console.log('Error getting subscriber.');
                                    ShowPanel(99);
                                } 
                                else {
                                   this.store_groups = response.data;
                                   
                                    /*get the subscribers state*/
                                   for(var i = 0; i < this.store_groups.length; i++) {
                                        var obj = this.store_groups[i];
                                        if(obj.Store == this.form.store_group) {
                                            this.store_state = obj.State;
                                            break;
                                        }
                                   }
                                  
                                   /* populate state dropdown for active stores */
                                   for(var i = 0; i < stateCodes.length; i++) {
                                      if(this.store_state && stateCodes[i].code == this.store_state) {
                                            this.availableStoreStates.push(stateCodes[i]);
                                            continue;
                                        }
                                      
                                        for(var j = 0; j < this.store_groups.length; j++) {
                                            if(stateCodes[i].code == this.store_groups[j].State) {
                                                this.availableStoreStates.push(stateCodes[i]);
                                                break;
                                            }
                                        }
                                   }
                                  
                                   this.filterDropDownByState();
                                }
                            }.bind(this)
                        )
                    }
                }
            .bind(this),
                function (error) {
                this.form.Error = true;
                console.log(error);
                ShowPanel(99);
            }
            .bind(this)).catch(function (e) {
                this.form.Error = true;
                console.log(e);
                ShowPanel(99);
            }
            .bind(this))
        },
        methods: {
            checkAll: function(val) {
                if(val) {
                    var checked = document.getElementById("allTopics").checked;
                    if(checked) {
                        this.form.i_Weekly_Specials_and_Sales = "true";
                        this.form.i_Recipes_and_Tips = "true";
                        this.form.i_Store_Events = "true";
                        this.form.i_New_Items = "true";
                        this.form.i_Local_Products = "true";
                        this.form.i_Vegetarian_Foods = "true";
                        this.form.i_Gluten_Free_Foods = "true";
                        this.form.i_Kosher_Foods = "true";
                    }
                }
                else {
                    document.getElementById("allTopics").checked = false;
                }
            },
            filterDropDownByState: function() {
                var list = [];
                for(var i = 0; i < this.store_groups.length; i++) {
                    var obj = this.store_groups[i];
                    if(!this.store_state || obj.State == this.store_state) {
                        obj.Name = obj.Street_Address;
                        if(obj.Second_Address) 
                           obj.Name = obj.Name + " " + obj.Second_Address;
                        obj.Name = obj.Name + ", " + obj.City + ", " + obj.State + " " + obj.Zip;
                       list.push(obj);
                   }
                }
                this.filteredStoreList = list;
            },
            SubmitUnsubReason: function() {
                var reason = "";
                if(this.UnsubReason1){
                    reason = this.UnsubReason1;
                }
                if(this.UnsubReason2){
                    if(reason.length > 0) 
                        reason = reason + "|";
                    reason = reason + this.UnsubReason2;
                }
                if(this.UnsubReason3){
                    if(reason.length > 0) 
                        reason = reason + "|";
                    reason = reason + this.UnsubReason3;
                }
                if(this.UnsubReason4){
                    if(reason.length > 0) 
                        reason = reason + "|";
                    reason = reason + this.UnsubReason4;
                }
                if(reason.length > 0){
                    this.form.unsubscribe_reason = reason;
                    this.Org_PreferenceStatus = "unsubscribed";
                    this.submit(false);
                   
                }
                else {
                    /*no reason selected*/
                }
            },
            updatePref: function () {
            
                var bodyFormData = new FormData();
                for (var key in this.form) {
                    if(key != "EmailAddress" && key != "SubscriberExists" 
                       && key != "SubscriberKey" && key != "Error" && key != "submitted"
                       && this.form[key] && typeof this.form[key] == "string" ) {
                        bodyFormData.append(key, this.form[key].trim());
                    }
                }

                axios.post(updateURL, bodyFormData, {
                    headers: {
                        'Content-type': 'application/x-www-form-urlencoded'
                    }
                })
               .then( 
                    function (response) {
                        if (!response || response.data.requestStatus == "ERROR") {
                            this.form.Error = true;
                            console.log('Error getting subscriber.');
                            ShowPanel(99);
                        } else {
                            if( response.data.data.EmailAddress == response.data.data.New_EmailAddress)
                                response.data.data.New_EmailAddress = "";
                            this.form = response.data.data;
                           
                            if(this.form.PreferenceStatus == "unsubscribed" 
                               && this.form.PreferenceStatus != this.Org_PreferenceStatus) {
                                this.Org_PreferenceStatus = this.form.PreferenceStatus;
                                ShowPanel(3);
                            }
                            else {
                                this.Org_PreferenceStatus = this.form.PreferenceStatus;
                                ShowPanel(2);
                            }
                        }
                    }
                    .bind(this),
                        function (error) {
                        this.form.Error = true;
                        console.log(error);
                        ShowPanel(99);
                    }
                    .bind(this)
                )
                .catch(function (e) {
                        console.log(e);
                        ShowPanel(99);
                    }
                    .bind(this)
                )
            },
            validateForm: function () {
                return true;
            },
            validateField: function (x) {},
            submit: function (doValidate) {
                if(doValidate) {
                    if( !this.IsValid_ZipCode ){
                        ScrollTo("ZipCode");
                        return;
                    }
                    else if (!this.IsValid_New_EmailAddress) {
                        ScrollTo("New_EmailAddress");
                        return;
                    }
                }
                this.updatePref();
            }
        }
    });
      
    var ShowPanel = function(num){
       $("#formPanel").css("display","none");
       $("#confirmPanel").css("display","none");
       $("#unsubSurveyPanel").css("display","none");
       $("#errorPanel").css("display","none");
      
        if(num == 1) {
            $("#formPanel").css("display","block");
        }
        else if(num == 2) {
            $("#confirmPanel").css("display","block");
        }
        else if(num == 3) {
            $("#unsubSurveyPanel").css("display","block");
        }
        else {
            $("#errorPanel").css("display","block");
        }
      
        try {
            history.pushState({}, "", window.location);
        } 
        catch(e) {
        }
      
        window.scrollTo(0,0);
    }
    </script>
  </body>
</html>